kind: pipeline
spec:
  steps:
    - name: 'Clean'
      operation: drop
      arguments:
        data-selector: '*@sqlite'

    - name: 'Load the users'
      operation: insert
      args: # alias for arguments
        source:
          data-selector: data/users.csv
        target:
          target-uri: users@sqlite


    - name: 'Load the web events'
      operation: insert
      arguments:
        data-selector: data/events.jsonl
        target-uri: events@sqlite

    - name: 'Event Processing first pass'
      operation: insert
      args:
        data-selector: (f_events.sql)@sqlite
        target-uri: f_events@sqlite

    - name: 'Event Processing second pass'
      operation: insert
      args:
        data-selector: (f_events_2.sql)@sqlite
        target-uri: f_events@sqlite

    - name: 'User Processing'
      operation: insert
      args:
        data-selector: (users.sql)@sqlite
        target-uri: users_1@sqlite

    - desc: 'Download analytics - Subscription started by month'
      operation: copy
      args:
        data-selector: (subscriptions_started_by_month.sql)@sqlite
        target-uri: out/susbscriptions_started_by_month.csv

