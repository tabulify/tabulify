---
title: "LatencyAnalytics"
author: "Nicolas"
date: "July 6, 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Loader Metrics Analysis

This is an R Markdown document that will analyse the metrics output file of the loader.


```{r data}
library(readr) # for csv
library(ggplot2)
library(plotly)
library(dplyr)
library(data.table) # for the %like% function

loaderMetrics <- read_csv("C:/Users/gerard/Desktop/logging/snel/1_C_RETAIL_INVENTORY_WEEK_0.csv", col_names = c("timestamp","metrics", "value"))

## "C:/Users/gerard/Desktop/logging/middel/2_C_SALES_TOTAL_0.log
## "C:/Users/gerard/Desktop/logging/snel/1_C_RETAIL_INVENTORY_WEEK_0.csv"

```

## Thread Analysis

Producer and consumer follows the same line.
The line were artificially moved from each other to be able to see them.

```{r pressure, echo=FALSE}
startTime = min(loaderMetrics$timestamp)
maxTime = max(loaderMetrics$timestamp)

as.numeric(difftime(maxTime, startTime, units="mins"))

producer = loaderMetrics %>%
  filter(metrics %like% "Producer") %>%
  mutate(timestamp = as.numeric(difftime(timestamp, startTime, units=c("mins"))), metrics = "Producer", value)

consumer = loaderMetrics %>%
  filter(metrics %like% "Consumer(.*)Records") %>%
  mutate(timestamp = as.numeric(difftime(timestamp, startTime, units=c("mins"))), metrics = "Consumer Total", value) %>%
  group_by(timestamp, metrics) %>%
  summarize(value=sum(value))


# Rows binds (Union)
loaderThreadMetrics = rbind(as.data.frame(producer), as.data.frame(consumer), make.row.names = FALSE)


ggplotly(ggplot(loaderThreadMetrics, aes(x=loaderThreadMetrics$timestamp, y=loaderThreadMetrics$value, color=loaderThreadMetrics$metrics)) +
  geom_line(position=position_dodge(width=2)) +
  labs(x="Time (min)",y="Rows",color="Threads"))

```


## Buffer Analysis


```{r pressure, echo=FALSE}


buffer = loaderMetrics %>%
  filter(metrics %like% "Buffer" & metrics != "Buffer Ratio" )


ggplot(buffer, aes(x=buffer$timestamp, y=buffer$value, color=buffer$metrics)) +
  geom_line() +
  labs(x="Time",y="Rows",color="Buffer")

```
