# 1st Docker build stage: build the project with Gradle
FROM gradle:7.5.1-jdk11 as builder
COPY .. /java-mono/
# workdir in the container
WORKDIR /java-mono/
RUN gradle :bytle-tower-edge:assemble --no-daemon

# 2nd Docker build stage: copy builder output and configure entry point
FROM adoptopenjdk:11-jre-hotspot
ENV APP_DIR /application
# uber/fat jar
ENV APP_FILE  bytle-tower-edge-all.jar

EXPOSE 8084

WORKDIR $APP_DIR
COPY --from=builder /java-mono/tower-edge/build/libs/*-all.jar $APP_DIR/$APP_FILE

ENTRYPOINT ["sh", "-c"]
CMD ["exec java -jar $APP_FILE"]
