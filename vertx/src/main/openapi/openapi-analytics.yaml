openapi: 3.0.3
paths: { }
info:
  title: Analytics Model
  description: The analytics model
  version: "v2023-06-18"
components:
  schemas:
    AnalyticsEventUser:
      description: The user properties
      type: object
      properties:
        userId:
          type: string
          description: A unique identifier
        userEmail:
          type: string
          description: the user email
    AnalyticsEventApp:
      description: The properties of the app that created this event
      type: object
      properties:
        appId:
          type: string
          description: The app id that has created this event
        appRealmId:
          type: string
          description: |
            The realm of the app
            If the user is not anonymous, it is the user audience.
        appOrganisationId:
          type: string
          description: the organization id (the billing logical unit, known also as the group id)
    AnalyticsEventRequest:
      description: The request/remote identifiers of an event
      type: object
      properties:
        agentId:
          type: string
          description: The agent id
        remoteIp:
          type: string
          description: The ip (the remote client ip)
          example: 143.176.206.76
        sessionId:
          type: string
          description: The session id (a nonce)
        originUri:
          type: string
          format: uri
          description: |
            The origin uri (from where the request originate inside the app)
            For a browser, the uri in the address bar or a iframe uri
            For a gui app, an uri that represents a page
        referrerUri:
          type: string
          format: uri
          description: |
            The http `referrer` header or javascript `document.referrer`
            Note that Google Analytics will use "utm_referrer" over "document.referrer"
            if set as document.referrer is only the domain/authority part
    AnalyticsEventTime:
      description: The times of the status
      type: object
      properties:
        creationTime:
          type: string
          format: date-time
          description: The timestamp when the event has happend (ie when the object was created)
        receptionTime:
          type: string
          format: date-time
          description: The timestamp of when a message was received on the API (if created and send by a client)
        sendingTime:
          type: string
          format: date-time
          description: |
            The timestamp of when a message was sent to the analytics endpoint api
            Time: With Ga, you cannot set the time, It uses the notion of queue
            https://developers.google.com/analytics/devguides/collection/protocol/v1/parameters#qt
    AnalyticsEventUtm:
      description: |
        The data that permits to derive the channel (ie how the
        user came in).
        UTM (Urchin Tracking Module) data with the document referer.
            See:
            * <a href="https://datacadamia.com/marketing/analytics/utm">UTM</a>
            * <a href="https://ga-dev-tools.google/campaign-url-builder/">UTM builder</a>
            * <a href="https://support.google.com/analytics/answer/10917952">[GA4] URL builders: Collect campaign data with custom URLs</a>
      type: object
      properties:
        utmCampaignId:
          type: string
          description: |
            The Campaign ID is used to identify a specific ad campaign or promotion
            Known as utm_id, this is a required key for GA4 data import.
          example: summer-sale, abc.123
        utmCampaign:
          type: string
          description: The Utm Campaign Name (utm_campaign)
          example: spring_sale, Product, slogan, promo code
        utmSource:
          type: string
          description: |
            Referrer.
            Identifies which site sent the traffic, and is a required parameter
            Example: the referrer (e.g. google, newsletter)
          example: summer-mailer
        utmMedium:
          type: string
          description: |
            Marketing medium (e.g. cpc, banner, email)
            Identifies what type of link was used, such as cost per click or email.
          example: email
        utmTerm:
          type: string
          description: |
            Identifies search terms, the paid keywords
        utmContent:
          type: string
          description: |
            Identifies what specifically was clicked to bring the user to the site,
            such as a banner ad or a text link.
            It is often used for A/B testing and content-targeted ads
        utmReferrer:
          type: string
          format: uri
          description: |
            Identifies the referrer URL as it's not passed by default by browser HTTP request
            and therefore not available in the `document.referrer` attribute
            Google Analytics will use "utm_referrer" over "http header / javascript document.referrer"
            utm_source is also a referer but in a named format
    AnalyticsAgent:
      description: The properties of a user agent
      type: object
      properties:
        agentId:
          type: string
          description: |
            The user agent/device id (a uuid4 or a fingerprint for instance)

            It's also known as the user anonymous id because this is the user identifier
            when the user is unknown.

            When you send a message, a userId or a deviceId is required in order to identify a user.

            We prefer the term device id (mixpanel) over anonymous id (segment) because it's
            more meaningful. We track the device.

            It's created on the client side and stored by the client more permanently
            (via a cookie for the browser and stored in local storage for durability).

            It's not the same as a session id because:
            * a session id may be regenerated (when the user sign in for instance).
            * the device id does not have any security feature. You can't login
        agentString:
          type: string
          description: The user agent string
        agentTimezone:
          type: string
          description: the timezone id (ie Europe/London)
        agentLocale:
          type: string
          description: the locale (in a browser, this is the language setting)
        agentOsName:
          type: string
          description: the OS name
        agentOsVersion:
          type: string
          description: the OS version
        agentOsArch:
          type: string
          description: the OS architecture
    AnalyticsEvent:
      description: |
        The event. They are the things that happen in our product.

        We follow a mix of
        * the <a href="https://segment.com/docs/connections/spec/common/">Segment Spec</a>
        * the <a href="https://segment.com/docs/connections/spec/common/">MixPanel Spec</a>

        Every event type will extend this object and add its properties.

        We try to follow the element of a sequential diagram with the following participants:
        * user: the user
        * agent: the agent that the user is using
        * request: the request
        * time: the state times
        * channel: the channel properties (how the user came in)

        All properties that are tied only to the event type/name
        are properties added at the root with a primary datatype.

      type: object
      properties:
        id:
          type: string
          description: |
            A unique identifier for each event.

            It allows to delete duplicate.

            It's a timestamp based UUID
            where the timestamp is the value of the creation time.
            (It permits to quickly retrieve via partition an event)

            It's known for:
            * segment as messageId
            * mixpanel as $insert_id
        name:
          type: string
          description: the event name/type
        time:
          $ref: '#/components/schemas/AnalyticsEventTime'
        app:
          $ref: '#/components/schemas/AnalyticsEventApp'
        user:
          $ref: '#/components/schemas/AnalyticsEventUser'
        request:
          $ref: '#/components/schemas/AnalyticsEventRequest'
        utm:
          $ref: '#/components/schemas/AnalyticsEventUtm'
        properties:
          description: The additional unknown event properties
          additionalProperties:
            type: object # may be number, string, boolean
    AnalyticsUser:
      description: The user
      type: object
      properties:
        id:
          type: string
          description: A unique identifier
        givenName:
          type: string
          description: the user given name
        email:
          type: string
          description: the user email
        avatar:
          type: string
          format: uri
          description: the user avatar
        creationTime:
          type: string
          format: date-time
          description: The timestamp when the user was created
