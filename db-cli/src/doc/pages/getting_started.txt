====== Bytle Db - Getting started ======


====== Introduction ======

[[start|Bytle-Db]] is a command line (''CLI'') that helps you perform operations against any data structure at the command line in a simple and effective way.

This ''Getting Started'' will demonstrate basic database relational operations such as:
  * [[#listing_tables|listing tables]]
  * [[#creating_a_sample_schema|creating sample tables]]
  * [[#filling_the_schema_with_data|filling tables with data]]
  * [[#listing_the_relations_between_tables_ie_foreign_key|listing the relationship between tables]]
  * [[#execute_a_query|executing a query]]
  * [[#executing_a_query_benchmark|executing multiple queries (ie query benchmark)]]



====== Steps ======
===== Installation =====
To install [[db|Bytle-Db]] on your computer, follow the instructions on the [[install|installation page]]

===== Command line Syntax =====
  * Typing ''db'' at the command line should give you the following response
<unit>
<code dos>
db --help
</code>
<console>
A Sdk for the database

Syntax: (1)

	db [options|flags] <command>

where:

	Command (is one of):
		* table                         operations on one or several tables
		* database                      operations on database
		* schema                        operations on a schema
		* query                         operations on a query
		* sample                        create and fill data into a sample schema
		* fkey                          operations on foreign key (ie on relation and constraints between tables)

	Local: (1)
		* -h,--help                     Print this help
		* --conf <path>                 The path to the config file
		* --db.target.url <value>       No Description available
		* --db.target.driver <value>    No Description available

To load data from a csv file you would type:
db table load TABLE_NAME.csv
</console>
</unit>

[[db|db]] is a command line client that is made of the following [[module|module]]:
  * [[table:table]]
  * [[schema]]
  * [[query]]

For each ''sub-command'', you may specify optional [[option|options]] that change the default behavior. 

===== Listing tables =====

''db'' uses as default database a local embedded ''sqlite'' database.

To list all ''tables'' in your current database schema, you need to perform the following command:
<unit>
<code dos>
db table list
</code>
<console>
No tables found
</console>
</unit>

There is obviously no table in our default database. We will create some below by creating a [[sample|sample database]].

===== Creating a sample schema =====
The [[sample|sample module]] provides several sample database. We will create the [[tpcds|tpcds]] datawarehouse part with the ''create'' command.

<unit>
<code dos>
db sample create tpcds-dwh
</code>
<console>
Table (reason) created.
Table (customer_demographics) created.
Table (date_dim) created.
Table (customer_address) created.
Table (income_band) created.
Table (item) created.
Table (ship_mode) created.
Table (warehouse) created.
Table (time_dim) created.
Table (dbgen_version) created.
Table (web_site) created.
Table (store) created.
Table (call_center) created.
Table (catalog_page) created.
Table (household_demographics) created.
Table (promotion) created.
Table (inventory) created.
Table (customer) created.
Table (web_page) created.
Table (store_sales) created.
Table (catalog_sales) created.
Table (web_sales) created.
Table (store_returns) created.
Table (catalog_returns) created.
Table (web_returns) created.
</console>
</unit>
<wrap info>Note that the tables are not created by alphabetic order but by foreign key graph order. (Ie the primary key must be created before the foreign key).
That's why we see at the end of the list most of the fact tables. They are created after the dimensions.</wrap>

  * How many tables do we have ?
<unit>
<code dos>
db table count
</code>
<console>
25 tables
</console>
</unit>
===== Filling the schema with data =====
To fill our schema with generated data, we will use the ''fill'' sub-command of [[sample|sample]].

<unit>
<code dos>
db sample fill tpcds-dwh
</code>
At the end of the process, you get a list of all tables where data were loaded and the number of row that were inserted.
<console>
The table (reason) exists in the target database (target)
The table (customer_demographics) exists in the target database (target)
The table (date_dim) exists in the target database (target)
The table (customer_address) exists in the target database (target)
The table (income_band) exists in the target database (target)
The table (item) exists in the target database (target)
The table (ship_mode) exists in the target database (target)
The table (warehouse) exists in the target database (target)
The table (time_dim) exists in the target database (target)
The table (dbgen_version) exists in the target database (target)
The table (web_site) exists in the target database (target)
The table (store) exists in the target database (target)
The table (call_center) exists in the target database (target)
The table (catalog_page) exists in the target database (target)
The table (household_demographics) exists in the target database (target)
The table (promotion) exists in the target database (target)
The table (inventory) exists in the target database (target)
The table (customer) exists in the target database (target)
The table (web_page) exists in the target database (target)
The table (store_sales) exists in the target database (target)
The table (catalog_sales) exists in the target database (target)
The table (web_sales) exists in the target database (target)
The table (store_returns) exists in the target database (target)
The table (catalog_returns) exists in the target database (target)
The table (web_returns) exists in the target database (target)
Results:
Tables Loaded            Rows Inserted   
----------------------   -------------   
call_center                          2   
catalog_page                     11718   
catalog_returns                   8923   
catalog_sales                    89807   
customer                          1000   
customer_address                  1000   
customer_demographics          1920800   
date_dim                         73049   
dbgen_version                        1   
household_demographics            7200   
income_band                         20   
inventory                       261261   
item                              2000   
promotion                            3   
reason                               1   
ship_mode                           20   
store                                2   
store_returns                    11925   
store_sales                     120527   
time_dim                         86400   
warehouse                            1   
web_page                             2   
web_returns                       1152   
web_sales                        11876   
web_site                             2
</console>
</unit>

===== Listing the tables again =====

You could list information on the table with the ''list'' command. <wrap info>Note that the output must be the same than the ''db sample fill'' command.</wrap>
<unit>
<code dos>
db table list
</code>
<console>
Tables:

Table Name                 Count   
----------------------   -------   
call_center                    2   
catalog_page               11718   
catalog_returns             8923   
catalog_sales              89807   
customer                    1000   
customer_address            1000   
customer_demographics    1920800   
date_dim                   73049   
dbgen_version                  1   
household_demographics      7200   
income_band                   20   
inventory                 261261   
item                        2000   
promotion                      3   
reason                         1   
ship_mode                     20   
store                          2   
store_returns              11925   
store_sales               120527   
time_dim                   86400   
warehouse                      1   
web_page                       2   
web_returns                 1152   
web_sales                  11876   
web_site                       2
</console>
</unit>

===== Listing the relations between tables (ie foreign key) =====

<unit>
<code dos>
db fkey list
</code>
<console>
ForeignKeys:
Id   Child Table              <-   Parent Table             From Foreign Key             
--   ----------------------   --   ----------------------   --------------------------   
 1   call_center              <-   date_dim                 call_center_fk1              
 2   catalog_page             <-   date_dim                 catalog_page_fk0             
 3   catalog_returns          <-   call_center              catalog_returns_fk7          
 4   catalog_returns          <-   catalog_page             catalog_returns_fk9          
 5   catalog_returns          <-   catalog_sales            catalog_returns_fk8          
 6   catalog_returns          <-   customer                 catalog_returns_fk6          
 7   catalog_returns          <-   customer_address         catalog_returns_fk1          
 8   catalog_returns          <-   customer_demographics    catalog_returns_fk16         
 9   catalog_returns          <-   date_dim                 catalog_returns_fk2          
10   catalog_returns          <-   household_demographics   catalog_returns_fk10         
11   catalog_returns          <-   item                     catalog_returns_fk4          
12   catalog_returns          <-   reason                   catalog_returns_fk3          
13   catalog_returns          <-   ship_mode                catalog_returns_fk11         
14   catalog_returns          <-   time_dim                 catalog_returns_fk5          
15   catalog_returns          <-   warehouse                catalog_returns_fk13         
16   catalog_sales            <-   call_center              catalog_sales_fk10           
17   catalog_sales            <-   catalog_page             catalog_sales_fk12           
18   catalog_sales            <-   customer                 catalog_sales_fk13           
19   catalog_sales            <-   customer_address         catalog_sales_fk8            
20   catalog_sales            <-   customer_demographics    catalog_sales_fk16           
21   catalog_sales            <-   date_dim                 catalog_sales_fk14           
22   catalog_sales            <-   household_demographics   catalog_sales_fk15           
23   catalog_sales            <-   item                     catalog_sales_fk2            
24   catalog_sales            <-   promotion                catalog_sales_fk3            
25   catalog_sales            <-   ship_mode                catalog_sales_fk0            
26   catalog_sales            <-   time_dim                 catalog_sales_fk9            
27   catalog_sales            <-   warehouse                catalog_sales_fk1            
28   customer                 <-   customer_address         customer_fk3                 
29   customer                 <-   customer_demographics    customer_fk5                 
30   customer                 <-   date_dim                 customer_fk2                 
31   customer                 <-   household_demographics   customer_fk4                 
32   household_demographics   <-   income_band              household_demographics_fk0   
33   inventory                <-   date_dim                 inventory_fk0                
34   inventory                <-   item                     inventory_fk1                
35   inventory                <-   warehouse                inventory_fk2                
36   promotion                <-   date_dim                 promotion_fk2                
37   promotion                <-   item                     promotion_fk1                
38   store_returns            <-   customer                 store_returns_fk0            
39   store_returns            <-   customer_address         store_returns_fk8            
40   store_returns            <-   customer_demographics    store_returns_fk3            
41   store_returns            <-   date_dim                 store_returns_fk4            
42   store_returns            <-   household_demographics   store_returns_fk2            
43   store_returns            <-   item                     store_returns_fk5            
44   store_returns            <-   reason                   store_returns_fk9            
45   store_returns            <-   store                    store_returns_fk7            
46   store_returns            <-   store_sales              store_returns_fk1            
47   store_returns            <-   time_dim                 store_returns_fk6            
48   store_sales              <-   customer                 store_sales_fk8              
49   store_sales              <-   customer_address         store_sales_fk1              
50   store_sales              <-   customer_demographics    store_sales_fk5              
51   store_sales              <-   date_dim                 store_sales_fk3              
52   store_sales              <-   household_demographics   store_sales_fk6              
53   store_sales              <-   item                     store_sales_fk7              
54   store_sales              <-   promotion                store_sales_fk0              
55   store_sales              <-   store                    store_sales_fk2              
56   store_sales              <-   time_dim                 store_sales_fk4              
57   store                    <-   date_dim                 store_fk0                    
58   web_page                 <-   customer                 web_page_fk2                 
59   web_page                 <-   date_dim                 web_page_fk0                 
60   web_returns              <-   customer                 web_returns_fk1              
61   web_returns              <-   customer_address         web_returns_fk9              
62   web_returns              <-   customer_demographics    web_returns_fk0              
63   web_returns              <-   date_dim                 web_returns_fk8              
64   web_returns              <-   household_demographics   web_returns_fk5              
65   web_returns              <-   item                     web_returns_fk11             
66   web_returns              <-   reason                   web_returns_fk12             
67   web_returns              <-   time_dim                 web_returns_fk6              
68   web_returns              <-   web_page                 web_returns_fk7              
69   web_returns              <-   web_sales                web_returns_fk10             
70   web_sales                <-   customer                 web_sales_fk5                
71   web_sales                <-   customer_address         web_sales_fk8                
72   web_sales                <-   customer_demographics    web_sales_fk4                
73   web_sales                <-   date_dim                 web_sales_fk15               
74   web_sales                <-   household_demographics   web_sales_fk7                
75   web_sales                <-   item                     web_sales_fk6                
76   web_sales                <-   promotion                web_sales_fk16               
77   web_sales                <-   ship_mode                web_sales_fk9                
78   web_sales                <-   time_dim                 web_sales_fk14               
79   web_sales                <-   warehouse                web_sales_fk10               
80   web_sales                <-   web_page                 web_sales_fk11               
81   web_sales                <-   web_site                 web_sales_fk12               
82   web_site                 <-   date_dim                 web_site_fk0                 

Tip: You can show the columns by adding the c flag.
</console>
</unit>

===== Execute a Query =====

Tpcds offers 100 queries. We will execute the query number 11 with the [[query:execute|execute]] command of the query module. 

The file containing this query is located at
''BYTLE_DB_HOME\sql\tpcds\query\sqlite\query_11.sql'' where [[BYTLE_DB_HOME|BYTLE_DB_HOME]] is the installation directory.

Below is an excerpt because this query is very long.

It shows customers that have generated growing sales from one year to another in the ''s'' and ''w'' sales type.

<code sql query_11.sql>
with year_total as (
 select c_customer_id customer_id
       ,c_first_name customer_first_name
       ,c_last_name customer_last_name
       ,c_preferred_cust_flag customer_preferred_cust_flag
       ,c_birth_country customer_birth_country
       ,c_login customer_login
       ,c_email_address customer_email_address
       ,d_year dyear
       ,sum(ss_ext_list_price-ss_ext_discount_amt) year_total
       ,'s' sale_type
 from customer
     ,store_sales
     ,date_dim
 where
...
</code>
  * Executing the query will show us this customers.
<unit envBYTLE_DB_HOME=..\db-tpc\src\main>
<code dos db_query_execute.cmd>
db query execute %BYTLE_DB_HOME%\sql\tpcds\query\sqlite\query_11.sql
</code> 
<console>
customer_id        customer_first_name   customer_last_name   customer_email_address                   
----------------   -------------------   ------------------   --------------------------------------   
AAAAAAAABMDAAAAA   Jose                  Guzman               Jose.Guzman@stJp.edu                     
AAAAAAAAFLAAAAAA   Joseph                Riley                Joseph.Riley@znxF.com                    
AAAAAAAAFNCAAAAA   Jennifer              Fitzpatrick          Jennifer.Fitzpatrick@9AK6ZnfkDN7T.edu    
AAAAAAAAJCAAAAAA   Maxine                Carlson              Maxine.Carlson@StyP5lAokmQ29QHYMLa.edu   
AAAAAAAAJGBAAAAA   Bonnie                Harrison             Bonnie.Harrison@AKYSOPlHEYkd.com         
AAAAAAAAKMDAAAAA   Alexander             White                Alexander.White@7v2XsptkFrc50K.org       
AAAAAAAAOFCAAAAA   Timothy               Grogan               Timothy.Grogan@pn3NH2BDng.org            
AAAAAAAAPCBAAAAA   Luz                   Ransom               Luz.Ransom@fXu5MmHo2tfK.edu              
AAAAAAAAPDDAAAAA   Reginald              Garcia               Reginald.Garcia@8NKIJxQZ.org
</console>
</unit>


===== Executing a Query benchmark =====
''Bytle-Db'' is able to [[execute|execute]] every query stored in ''sql'' files in a directory.

[[tpcds|tpcds]] is a benchmark and offers 100 queries that we will execute. 

<wrap info>All 100 queries are not present because ''Sqlite'' does not implement all standard ANSI clause but as since version [[https://www.sqlite.org/draft/releaselog/3_25_0.html|3.25]] support window functions, most of the analytics query are working.</wrap>

All ''Tpcds'' queries are located at ''DB_HOME\sql\tpcds\query\sqlite'' where ''DB_HOME'' is the directory where ''Bytle-Db'' was unzipped/installed.

<unit envBYTLE_DB_HOME=..\db-tpc\src\main>
<code dos>
db query execute %BYTLE_DB_HOME%\sql\tpcds\query\sqlite
</code>
<console>
Query Name     Latency (ms)   Row Count   Error   Message                                                                                             
------------   ------------   ---------   -----   -------------------------------------------------------------------------------------------------   
query_1.sql              99         100                                                                                                               
query_10.sql          43391           1                                                                                                               
query_11.sql           1862           9                                                                                                               
query_12.sql              2               Err     org.sqlite.SQLiteException: [SQLITE_ERROR] SQL error or missing database (near "(": syntax error)   
query_13.sql            134           1                                                                                                               
query_14.sql           3290         100                                                                                                               
query_15.sql             58          21                                                                                                               
query_18.sql            293          60                                                                                                               
query_19.sql             72          17                                                                                                               
query_2.sql             350        2513                                                                                                               
query_20.sql              0               Err     org.sqlite.SQLiteException: [SQLITE_ERROR] SQL error or missing database (near "(": syntax error)   
query_21.sql            339           0                                                                                                               
query_22.sql            169         100                                                                                                               
query_23.sql           1509           1                                                                                                               
query_24.sql            149           0                                                                                                               
query_25.sql            331           0                                                                                                               
query_26.sql            315         100                                                                                                               
query_27.sql            326         100                                                                                                               
query_28.sql            247           1                                                                                                               
query_29.sql            243           0                                                                                                               
query_3.sql              85           2                                                                                                               
query_30.sql             23           3                                                                                                               
query_31.sql           1636           0                                                                                                               
query_32.sql             68           1                                                                                                               
query_33.sql            136         100                                                                                                               
query_34.sql             77          12                                                                                                               
query_35.sql          38234         100                                                                                                               
query_36.sql              1               Err     org.sqlite.SQLiteException: [SQLITE_ERROR] SQL error or missing database (near "(": syntax error)   
query_37.sql            166           0                                                                                                               
query_38.sql            176           1                                                                                                               
query_4.sql            4739           7                                                                                                               
query_40.sql            127          40                                                                                                               
query_41.sql             32           0                                                                                                               
query_42.sql            136           6                                                                                                               
query_43.sql             84           2                                                                                                               
query_44.sql              1               Err     org.sqlite.SQLiteException: [SQLITE_ERROR] SQL error or missing database (near "(": syntax error)   
query_45.sql             12           5                                                                                                               
query_46.sql             86         100                                                                                                               
query_47.sql              0               Err     org.sqlite.SQLiteException: [SQLITE_ERROR] SQL error or missing database (near "(": syntax error)   
query_48.sql            140           1                                                                                                               
query_49.sql              4               Err     org.sqlite.SQLiteException: [SQLITE_ERROR] SQL error or missing database (near "(": syntax error)   
query_5.sql             302         100                                                                                                               
query_50.sql             89           2                                                                                                               
query_52.sql            124          10                                                                                                               
query_53.sql              0               Err     org.sqlite.SQLiteException: [SQLITE_ERROR] SQL error or missing database (near "(": syntax error)   
query_54.sql            365           0                                                                                                               
query_55.sql             74           7                                                                                                               
query_56.sql            212           3                                                                                                               
query_57.sql              1               Err     org.sqlite.SQLiteException: [SQLITE_ERROR] SQL error or missing database (near "(": syntax error)   
query_58.sql            764           0                                                                                                               
query_59.sql            485         100                                                                                                               
query_6.sql             318           3                                                                                                               
query_60.sql            170         100                                                                                                               
query_61.sql            142           1                                                                                                               
query_62.sql             36           6                                                                                                               
query_63.sql              1               Err     org.sqlite.SQLiteException: [SQLITE_ERROR] SQL error or missing database (near "(": syntax error)   
query_64.sql            559           0                                                                                                               
query_65.sql            158           4                                                                                                               
query_66.sql            108           1                                                                                                               
query_67.sql              0               Err     org.sqlite.SQLiteException: [SQLITE_ERROR] SQL error or missing database (near "(": syntax error)   
query_68.sql             75          79                                                                                                               
query_69.sql          40478          18                                                                                                               
query_7.sql             270         100                                                                                                               
query_70.sql              1               Err     org.sqlite.SQLiteException: [SQLITE_ERROR] SQL error or missing database (near "(": syntax error)   
query_71.sql            167          28                                                                                                               
query_72.sql           2628          22                                                                                                               
query_73.sql            138           0                                                                                                               
query_74.sql            906          14                                                                                                               
query_75.sql            765          32                                                                                                               
query_76.sql            159         100                                                                                                               
query_77.sql            176           7                                                                                                               
query_78.sql           1332         100                                                                                                               
query_79.sql            102         100                                                                                                               
query_8.sql               5           0                                                                                                               
query_80.sql            254          87                                                                                                               
query_81.sql             38           6                                                                                                               
query_82.sql             69           1                                                                                                               
query_83.sql            339           0                                                                                                               
query_84.sql             10           1                                                                                                               
query_85.sql             29           0                                                                                                               
query_86.sql              0               Err     org.sqlite.SQLiteException: [SQLITE_ERROR] SQL error or missing database (near "(": syntax error)   
query_88.sql           1152           1                                                                                                               
query_89.sql              0               Err     org.sqlite.SQLiteException: [SQLITE_ERROR] SQL error or missing database (near "(": syntax error)   
query_9.sql             390           1                                                                                                               
query_90.sql             20           1                                                                                                               
query_91.sql             14           0                                                                                                               
query_92.sql             11           1                                                                                                               
query_93.sql            165           0                                                                                                               
query_94.sql          60724           1                                                                                                               
query_95.sql             32           1                                                                                                               
query_96.sql            137           1                                                                                                               
query_98.sql              0               Err     org.sqlite.SQLiteException: [SQLITE_ERROR] SQL error or missing database (near "(": syntax error)   
query_99.sql            150          12
</console>
</unit>
