- name: Inbox | Create the cache dir
  file:
    state: directory
    path: '{{ inbox_cache_dir }}'
    group: '{{ apps_user_group }}'
    owner: '{{ apps_user_name }}'
    mode: 'u=rwx,g=rwx,o='
- name: Inbox | Copy the systemd service file
  notify: inbox restart
  template:
    src: '{{inbox_app_name}}.service'
    dest: '/etc/systemd/system/{{inbox_app_name}}.service'
    mode: 0644
- name: Inbox | Enable {{ inbox_app_name }} service
  notify: inbox restart
  systemd:
    name: '{{ inbox_app_name }}'
    enabled: true
- name: Inbox | Give the permission to java to use the port 25
  # See https://bugs.openjdk.org/browse/JDK-7157699
  block:
    - name: Inbox | Set the permission to java
      shell:
        cmd: |
          /sbin/setcap 'cap_net_bind_service=+ep' {{ inbox_java_path }}
    - name: Inbox | Add the jli lib path to the trusted path
      template:
        src: 'inbox-ld-java.conf'
        dest: '/etc/ld.so.conf.d/java.conf'
    - name: Inbox | Create the ld path list
      shell:
        cmd: |
          ldconfig
- name: Open port 25
  notify: firewalld reload
  firewalld:
    port: 25/tcp
    permanent: true
    state: enabled
- name: Open port 25025
  notify: firewalld reload
  firewalld:
    port: 25025/tcp
    permanent: true
    state: enabled
