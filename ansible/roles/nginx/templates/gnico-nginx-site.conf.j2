


# Root
server {

    # Change `example.com` to match your domain name.
    server_name {{ gnico_fqdn }};

    # the logs
    access_log  {{ gnico_log_dir }}/https-access.log;
    error_log  {{ gnico_log_dir }}/https-error.log;

    # listen to
    listen       443 ssl http2;
    listen       [::]:443 ssl http2;

    # ssl is needed to be able to redirect
    ssl_certificate_key "/etc/letsencrypt/live/{{ gnico_fqdn }}/privkey.pem";
    ssl_certificate "/etc/letsencrypt/live/{{ gnico_fqdn }}/fullchain.pem";
    ssl_session_cache shared:SSL:1m;
    ssl_session_timeout  10m;
    ssl_ciphers HIGH:!aNULL:!MD5;
    ssl_prefer_server_ciphers on;

    add_header 'Referrer-Policy' 'unsafe-url';
    return 301 https://{{ datacadamia_fqdn }}$request_uri;

}

# redirect to ssl
server {
    listen 80;
    server_name {{ gnico_fqdn }};
    return 301 https://{{ datacadamia_fqdn }}$request_uri;
    access_log  /var/log/nginx/{{ gnico_log_dir }}/http-access.log;
    error_log  /var/log/nginx/{{ gnico_log_dir }}/http-error.log;
}

# redirect www http
server {
    listen 80;
    server_name www.{{ gnico_fqdn }};
    return 301 https://{{ datacadamia_fqdn }}$request_uri;
    access_log  /var/log/nginx/{{ gnico_log_dir }}/http-access-www.log;
    error_log  /var/log/nginx/{{ gnico_log_dir }}/http-error-www.log;
}

# redirect www https
server {
    listen 443;
    server_name www.{{ gnico_fqdn }};
    return 301 https://{{ datacadamia_fqdn }}$request_uri;
    access_log  /var/log/nginx/{{ gnico_log_dir }}/https-access-www.log;
    error_log  /var/log/nginx/{{ gnico_log_dir }}/https-error-www.log;
}
