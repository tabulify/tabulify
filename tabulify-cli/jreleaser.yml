# $schema: https://jreleaser.org/schema/jreleaser-schema-1.17.0.json

environment:
  properties:
    jdkPathPrefix: 'plugins/jreleaser/build/jdks'

# https://jreleaser.org/guide/latest/reference/project.html
project:
  name: tabulify-cli
  #version: '{{projectVersion}}'
  description: Tabulify CLI application
  longDescription: |
    Tabulify CLI application for data manipulation and analysis.
  authors:
    - Tabulify Team
  copyright: '{{project.inceptionYear}}` Eraldy.com'
  license: FSL without Future License
  inceptionYear: '2020'
  tags:
    - cli
    - sql
    - csv
    - data processing
  links:
    homepage: https://tabulify
    documentation: https://tabulify
  languages:
    java:
      groupId: com.tabulify
      artifactId: tabulify-cli
      mainClass: net.bytle.db.tabli.Tabli
      version: '11'
      multiProject: true
  stereotype: CLI


release:
  github:
    owner: tabulify
    name: tabulify-cli

# Execute with jreleaser assemble
assemble:
  # https://jreleaser.org/guide/latest/reference/assemble/jlink.html
  jlink:
    # Assembly Name
    tabulify-jlink:
      active: ALWAYS
      java:
        version: '11'
      imageName: '{{distributionName}}-{{projectEffectiveVersion}}'
      executable: tabli
      fileSets:
        - input: '.'
          includes:
            - NOTICE
            - LICENSE
        - input: licenses
          output: licenses
      jdeps:
        multiRelease: base
        ignoreMissingDeps: true
        targets:
          - 'plugins/jreleaser/build/libs/jreleaser-{{projectVersion}}.jar'
      additionalModuleNames:
        - 'java.rmi'
        - 'java.security.sasl'
        - 'java.security.jgss'
        - 'jdk.crypto.cryptoki'
        - 'jdk.crypto.ec'
        - 'jdk.localedata'
        - 'jdk.net'
        - 'jdk.security.auth'
        - 'jdk.security.jgss'
      targetJdks:
        - path: '{{jdkPathPrefix}}/zulu21Osx/{{jdkFilePrefix}}-macosx_x64/zulu-21.jdk/Contents/Home'
          platform: 'osx-x86_64'
        - path: '{{jdkPathPrefix}}/zulu21OsxArm/{{jdkFilePrefix}}-macosx_aarch64/zulu-21.jdk/Contents/Home'
          platform: 'osx-aarch_64'
        - path: '{{jdkPathPrefix}}/zulu21Linux/{{jdkFilePrefix}}-linux_x64'
          platform: 'linux-x86_64'
        - path: '{{jdkPathPrefix}}/zulu21LinuxArm/{{jdkFilePrefix}}-linux_aarch64'
          platform: 'linux-aarch_64'
        - path: '{{jdkPathPrefix}}/zulu21LinuxMusl/{{jdkFilePrefix}}-linux_musl_x64'
          platform: 'linux_musl-x86_64'
        - path: '{{jdkPathPrefix}}/zulu21LinuxMuslArm/{{jdkFilePrefix}}-linux_musl_aarch64'
          platform: 'linux_musl-aarch_64'
        - path: '{{jdkPathPrefix}}/zulu21Windows/{{jdkFilePrefix}}-win_x64'
          platform: 'windows-x86_64'
        - path: '{{jdkPathPrefix}}/zulu21WindowsArm/{{jdkFilePrefix}}-win_aarch64'
          platform: 'windows-aarch_64'
      mainJar:
        path: 'plugins/jreleaser/build/libs/jreleaser-{{projectVersion}}.jar'
      jars:
        - pattern: 'plugins/jreleaser/build/dependencies/flat/*.jar'
      swid:
        tagRef: swid-tag

distributions:
  # Single Executable Jar
  # Doc: https://jreleaser.org/guide/latest/concepts/distributions/single-jar.html
  # Example: https://jreleaser.org/guide/latest/examples/java/single-jar.html
  fatjar:
    type: SINGLE_JAR
    artifacts:
      - path: target/{{distributionName}}-{{projectVersion}}-fatjar.jar


packagers:
  brew:
    active: ALWAYS
    multiPlatform: true
  chocolatey:
    active: ALWAYS
  docker:
    active: ALWAYS
    imageNames:
      - "tabulify/{{distributionName}}:{{tagName}}"
      - "tabulify/{{distributionName}}:latest"

